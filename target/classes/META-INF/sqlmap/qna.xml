<?xml version="1.0" encoding="UTF-8"?>
<!--
@Project : 
@File name : qna.xml
@Date : 2018.10.06
@Author : 우나연,임지현
@Desc : qna dao 매퍼 쿼리문 작성.
-->		

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="tk.copyNpaste.mapper.QnaMapper">
	<!-- QNA 게시물 조회-->
	<select id="selectAllQna" resultType="QnaVO" >
		select qna.qnaNum, qna.userEmail, users.userNick, qna.qnaTitle, qna.qnaContent, qna.qnaDate, qna.qnaDept, qna.qnaPNum, qna.qnaNotice, qna.qnaSecret, qna.qnaPos
		from qna join users on qna.userEmail = users.userEmail order by qna.qnaNotice desc, qna.qnaPos
	</select>
	
	<!-- 	//QNA 게시물 상세보기 -->
	<select id="selectDetailQna" parameterType="Integer" resultType="QnaVO">
		select qna.qnaNum, qna.userEmail, users.userNick, qna.qnaTitle, qna.qnaContent, qna.qnaDate, qna.qnaDept, qna.qnaPNum, qna.qnaNotice, qna.qnaSecret, qna.qnaPos
		from qna join users on qna.userEmail = users.userEmail where qna.qnaNum=#{qnaNum}
	</select>
	
	<!--//QNA 게시물 댓글 조회
	 public List<QnaCommVO> selectQnaComm(int qnaNum) throws Exception; -->
	 <select id="selectQnaComm" parameterType="Integer" resultType="QnaCommVO">
	 	select users.userNick,comm.qnaCommNum,comm.qnaNum,comm.userEmail,comm.qnaCommContent,comm.qnaCommDate,comm.qnaCommDept,comm.qnaCommPNum,comm.qnaCommPos
   		from qnacomm comm join users on comm.userEmail = users.userEmail where comm.qnaNum=#{qnaNum} order by comm.qnaCommPos
	 </select>
	
<!-- 	//QNA 게시물 검색
	public List<QnaVO> selectSearchQna(String keyword) throws Exception;-->	
 
<!-- 	//QNA 게시물 작성
	public int insertQna(QnaVO qna) throws Exception;
 -->

<!-- 	//QNA 게시글 수정
	public int updateQna(int qnaNum) throws Exception;
 -->	
<!-- 	//QNA 게시글 삭제
	public int deleteQna(int qnaNum) throws Exception;
 -->	
<!-- 	//QNA 댓글 작성
	public int insertQnaComm(QnaCommVO qnaComm) throws Exception;
 -->
 <insert id="insertQnaComm">
     <selectKey order="BEFORE" keyProperty="qnaCommPos" resultType="int">
      	select max(qnacommPos)+1 from qnaComm
     </selectKey>
     	insert into qnaComm(qnaNum,userEmail,qnaCommContent,qnaCommPos)
		values (#{qnaNum},#{userEmail},#{qnaCommContent},#{qnaCommPos})
    </insert>
 <!-- 	//QNA 댓글 삭제
	public int deleteQnaComm(int qnaCommNum) throws Exception; -->

</mapper>
